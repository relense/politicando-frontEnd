{"ast":null,"code":"import _regeneratorRuntime from \"/Users/miguelfurtado/Documents/Projetos/politicando/policando-frontend/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/miguelfurtado/Documents/Projetos/politicando/policando-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nexport function post(_x, _x2) {\n  return _post.apply(this, arguments);\n}\n\nfunction _post() {\n  _post = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(url, payload) {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", request(url, payload, \"POST\"));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n  return _post.apply(this, arguments);\n}\n\nexport function patch(_x3, _x4) {\n  return _patch.apply(this, arguments);\n}\n\nfunction _patch() {\n  _patch = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(url, payload) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", request(url, payload, \"PATCH\"));\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n  return _patch.apply(this, arguments);\n}\n\nexport function get(_x5) {\n  return _get.apply(this, arguments);\n}\n\nfunction _get() {\n  _get = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(url) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", request(url, {}, \"GET\"));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n  return _get.apply(this, arguments);\n}\n\nfunction request(_x6, _x7, _x8) {\n  return _request.apply(this, arguments);\n}\n\nfunction _request() {\n  _request = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(url, payload, method) {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return doRequest(url, payload, token, method);\n\n          case 2:\n            response = _context4.sent;\n            return _context4.abrupt(\"return\", response);\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this);\n  }));\n  return _request.apply(this, arguments);\n}\n\nfunction doRequest(_x9, _x10, _x11) {\n  return _doRequest.apply(this, arguments);\n}\n\nfunction _doRequest() {\n  _doRequest = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee5(url, payload, token) {\n    var method,\n        connectionType,\n        request,\n        responseStream,\n        resp,\n        _args5 = arguments;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            method = _args5.length > 3 && _args5[3] !== undefined ? _args5[3] : 'POST';\n            console.log(method + ' - ' + url);\n            console.log(JSON.stringify(payload));\n            _context5.next = 5;\n            return NetInfo.getConnectionInfo();\n\n          case 5:\n            connectionType = _context5.sent;\n\n            if (!(connectionType.type == 'none')) {\n              _context5.next = 8;\n              break;\n            }\n\n            throw {\n              errorCode: 'no_connection'\n            };\n\n          case 8:\n            request = {\n              cache: 'no-cache',\n              method: method,\n              headers: {\n                'content-type': 'application/json'\n              }\n            };\n            if (method !== 'GET') request.body = JSON.stringify(payload);\n            _context5.next = 12;\n            return fetch(url, request);\n\n          case 12:\n            responseStream = _context5.sent;\n\n            if (!(responseStream.status == 500)) {\n              _context5.next = 15;\n              break;\n            }\n\n            throw {\n              errorCode: 'server_error'\n            };\n\n          case 15:\n            if (!(responseStream.status == 401)) {\n              _context5.next = 17;\n              break;\n            }\n\n            throw {\n              responseStatus: 401,\n              errorCodes: 'Could not authenticate'\n            };\n\n          case 17:\n            if (!(responseStream.status === 204)) {\n              _context5.next = 19;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", {});\n\n          case 19:\n            _context5.next = 21;\n            return responseStream.json();\n\n          case 21:\n            resp = _context5.sent;\n\n            if (!(resp.hasOwnProperty('data') || responseStream.status === 200)) {\n              _context5.next = 24;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", resp);\n\n          case 24:\n            throw {\n              responseStatus: responseStream.status,\n              errorCodes: resp.hasOwnProperty('errors') ? resp.errors : ['unknown']\n            };\n\n          case 25:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, this);\n  }));\n  return _doRequest.apply(this, arguments);\n}\n\nexport function buildJsonPayload(type, attributes) {\n  var id = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var payload = {\n    data: {}\n  };\n  payload.data.type = type;\n  payload.data.attributes = attributes;\n  if (id) payload.data.id = id;\n  return payload;\n}\n\nvar unpack = function unpack(response) {\n  if (Array.isArray(response.data)) {\n    return {\n      links: response.links,\n      data: unpackResponseArray(response)\n    };\n  } else {\n    return unpackResponse(response);\n  }\n};\n\nexport var unpackResponse = function unpackResponse(response) {\n  var data = response.data.attributes;\n  data.jsonapi_identifier = response.data.id;\n  data.jsonapi_type = response.data.type;\n\n  if ('relationships' in response.data && 'included' in response) {\n    for (var key in response.data.relationships) {\n      var relation = response.data.relationships[key];\n\n      if (relation.data) {\n        (function () {\n          var _relation$data = relation.data,\n              id = _relation$data.id,\n              type = _relation$data.type;\n          data[key + 'Data'] = {};\n          data[key + 'Data']['id'] = id;\n          data[key + 'Data']['type'] = type;\n          var relatedObj = response.included.find(function (item) {\n            return item.id === id && item.type === type;\n          });\n          data[key + 'Data']['data'] = relatedObj && relatedObj.attributes;\n        })();\n      }\n    }\n  }\n\n  return data;\n};\nexport var unpackResponseArray = function unpackResponseArray(response) {\n  var responseData = response;\n  var items = [];\n\n  for (index in responseData) {\n    var data = {\n      data: responseData[index]\n    };\n\n    if ('included' in response) {\n      data.included = response.included;\n    }\n\n    items.push(unpackResponse(data));\n  }\n\n  return items;\n};","map":{"version":3,"sources":["/Users/miguelfurtado/Documents/Projetos/politicando/policando-frontend/src/api/Api.js"],"names":["post","url","payload","request","patch","get","method","doRequest","token","response","console","log","JSON","stringify","NetInfo","getConnectionInfo","connectionType","type","errorCode","cache","headers","body","fetch","responseStream","status","responseStatus","errorCodes","json","resp","hasOwnProperty","errors","buildJsonPayload","attributes","id","data","unpack","Array","isArray","links","unpackResponseArray","unpackResponse","jsonapi_identifier","jsonapi_type","key","relationships","relation","relatedObj","included","find","item","responseData","items","index","push"],"mappings":"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","sourcesContent":["export async function post(url, payload) {\n    return request(url, payload, \"POST\")\n}\n\nexport async function patch(url, payload) {\n    return request(url, payload, \"PATCH\")\n}\n\nexport async function get(url) {\n    return request(url, {}, \"GET\")\n}\n\nasync function request(url, payload, method) {\n    const response = await doRequest(url, payload, token, method);\n    return response\n}\n\nasync function doRequest(url, payload, token, method = 'POST') {\n    console.log(method + ' - ' + url);\n    console.log(JSON.stringify(payload));\n\n    const connectionType = await NetInfo.getConnectionInfo();\n\n    if (connectionType.type == 'none') {\n        throw {\n            errorCode: 'no_connection'\n        }\n    }\n\n    const request = {\n        cache: 'no-cache',\n        method: method,\n        headers: {\n          'content-type': 'application/json'\n        }\n    }\n\n    if (method !== 'GET') request.body = JSON.stringify(payload);\n\n    const responseStream = await fetch(url, request)\n\n    if (responseStream.status == 500) {\n        throw {\n            errorCode: 'server_error'\n        }\n    }\n\n    if (responseStream.status == 401) {\n        //Auth failed\n        throw {\n            responseStatus: 401,\n            errorCodes: 'Could not authenticate'\n        }\n    }\n\n    //successful no body\n    if (responseStream.status === 204) {\n        return {}\n    }\n\n    const resp = await responseStream.json()\n    if (resp.hasOwnProperty('data') || responseStream.status === 200) {\n        return resp\n    }\n\n    throw {\n        responseStatus: responseStream.status,\n        errorCodes: resp.hasOwnProperty('errors') ? resp.errors :  ['unknown']\n    }\n}\n\nexport function buildJsonPayload (type, attributes, id=null) {\n    let payload = { data: {} };\n    payload.data.type = type;\n    payload.data.attributes = attributes;\n    if (id) payload.data.id = id;\n\n    return payload;\n}\n\nconst unpack = (response) => {\n    if (Array.isArray(response.data)) {\n        return {\n            links: response.links,\n            data: unpackResponseArray(response)\n        };\n    } else {\n        return unpackResponse(response);\n    }\n}\n\nexport const unpackResponse = (response) => {\n    let data = response.data.attributes\n    data.jsonapi_identifier = response.data.id\n    data.jsonapi_type = response.data.type\n\n    if ('relationships' in response.data && 'included' in response) {\n        for(let key in response.data.relationships) {\n            const relation = response.data.relationships[key]\n\n            if (relation.data) {\n                const { id, type } = relation.data\n\n                data[key+'Data'] = {}\n                data[key+'Data']['id'] = id\n                data[key+'Data']['type'] = type\n\n                const relatedObj = response.included.find(function(item) {\n                    return item.id === id && item.type === type\n                })\n\n                data[key+'Data']['data'] = relatedObj && relatedObj.attributes\n            }\n        }\n    }\n\n    return data\n}\n\nexport const unpackResponseArray = (response) => {\n    const responseData = response\n    let items = []\n\n    for(index in responseData) {\n        const data = {\n            data: responseData[index],\n        }\n        if ('included' in response) {\n            data.included = response.included\n        }\n        items.push(unpackResponse(data))\n    }\n\n    return items\n}\n"]},"metadata":{},"sourceType":"module"}